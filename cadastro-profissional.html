<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DoctorCall - Cadastro de Profissional</title>
  <link rel="stylesheet" href="style.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
</head>
<body>
  <nav class="menu-superior">
    <div class="menu-container">
      <div class="logo">
        <span class="material-icons">medical_services</span>
        DoctorCall
      </div>
      <ul class="menu-items">
        <li><a href="index.html"><span class="material-icons">home</span> Home</a></li>
        <li><a href="sobre-nos.html"><span class="material-icons">info</span> Sobre Nós</a></li>
        <li><a href="medicos.html"><span class="material-icons">people</span> Médicos</a></li>
        <li><a href="consultas.html"><span class="material-icons">event_note</span> Minhas Consultas</a></li>
        <li><a href="cadastro-profissional.html" class="ativo"><span class="material-icons">person_add</span> Cadastrar</a></li>
      </ul>
    </div>
  </nav>

  <main class="container">
    <section class="secao">
      <h2><span class="material-icons">person_add</span> Gerenciar Profissionais</h2>
      
      <div class="conteudo">
        <div class="profissionais-lista" id="profissionais-lista"></div>

        

        <form id="form-profissional" class="form-cadastro">
          <div class="form-group">
            <label for="nome">
              <span class="material-icons">person</span>
              Nome Completo
            </label>
            <input type="text" id="nome" name="nome" required placeholder="Digite o nome completo">
          </div>

          <div class="form-group">
            <label for="especialidade">
              <span class="material-icons">local_hospital</span>
              Especialidade
            </label>
            <input type="text" id="especialidade" name="especialidade" required placeholder="Ex: Cardiologia, Dermatologia">
          </div>

          <div class="form-group">
            <label for="crm">
              <span class="material-icons">badge</span>
              CRM
            </label>
            <input type="text" id="crm" name="crm" required placeholder="Ex: 12345-SP">
          </div>

          <div class="form-group">
            <label for="telefone">
              <span class="material-icons">phone</span>
              Telefone
            </label>
            <input type="tel" id="telefone" name="telefone" placeholder="(11) 98765-4321">
          </div>

          <div class="form-group">
            <label for="email">
              <span class="material-icons">email</span>
              E-mail
            </label>
            <input type="email" id="email" name="email" placeholder="profissional@email.com">
          </div>

          <div class="form-actions">
            <button type="button" id="btn-cancelar" class="btn btn-secondary">
              <span class="material-icons">cancel</span>
              Cancelar
            </button>
            <button type="submit" class="btn btn-primary" id="btn-submit">
              <span class="material-icons">save</span>
              <span id="btn-text">Cadastrar Profissional</span>
            </button>
          </div>
        </form>

        <div id="mensagem" class="mensagem" style="display: none;"></div>
      </div>
    </section>
  </main>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      let profissionalEditando = null;

      
      async function carregarProfissionais() {
        try {
          const response = await fetch('http://localhost:3000/profissionais');
          const profissionais = await response.json();
          
          const lista = document.getElementById('profissionais-lista');
          
          if (profissionais.length === 0) {
            lista.innerHTML = '<p style="text-align: center; color: #6b7280;">Nenhum profissional cadastrado ainda.</p>';
            return;
          }

          lista.innerHTML = profissionais.map((p, index) => `
            <div class="profissional-item" data-id="${p.id}">
              <div class="profissional-info">
                <h4>${p.nome}</h4>
                <p><strong>Especialidade:</strong> ${p.especialidade}</p>
                <p><strong>CRM:</strong> ${p.crm}</p>
                <p><strong>Telefone:</strong> ${p.telefone || 'N/A'}</p>
                <p><strong>E-mail:</strong> ${p.email || 'N/A'}</p>
              </div>
              <div class="profissional-acoes">
                <button type="button" class="btn-icone btn-editar btn-editar-prof" data-id="${p.id}" title="Editar">
                  <span class="material-icons">edit</span>
                </button>
                <button type="button" class="btn-icone btn-excluir btn-excluir-prof" data-id="${p.id}" data-nome="${p.nome}" title="Excluir">
                  <span class="material-icons">delete</span>
                </button>
              </div>
            </div>
          `).join('');
        } catch (error) {
          const lista = document.getElementById('profissionais-lista');
          lista.innerHTML = '<p style="text-align: center; color: #ef4444;">Erro ao conectar com o servidor.</p>';
        }
      }

      document.getElementById('profissionais-lista').addEventListener('click', (e) => {
        const editBtn = e.target.closest('.btn-editar-prof');
        const deleteBtn = e.target.closest('.btn-excluir-prof');
        
        if (editBtn) {
          e.preventDefault();
          e.stopPropagation();
          editarProfissional(editBtn.dataset.id);
        } else if (deleteBtn) {
          e.preventDefault();
          e.stopPropagation();
          excluirProfissional(deleteBtn.dataset.id, deleteBtn.dataset.nome);
        }
        });

      async function editarProfissional(id) {
      const response = await fetch(`http://localhost:3000/profissionais/${id}`);
      const profissional = await response.json();
      
      profissionalEditando = id;
      
      document.getElementById('nome').value = profissional.nome;
      document.getElementById('especialidade').value = profissional.especialidade;
      document.getElementById('crm').value = profissional.crm;
      document.getElementById('telefone').value = profissional.telefone || '';
      document.getElementById('email').value = profissional.email || '';
      
      document.getElementById('btn-text').textContent = 'Atualizar';
      
      document.getElementById('form-profissional').scrollIntoView({ behavior: 'smooth' });
      }

      async function excluirProfissional(id, nome) {
      if (!confirm(`Tem certeza que deseja excluir o profissional "${nome}"?`)) {
        return;
      }

      try {
        const response = await fetch(`http://localhost:3000/profissionais/${id}`, {
          method: 'DELETE'
        });

        if (response.ok) {
          alert('Profissional excluído com sucesso!');
          carregarProfissionais();
        } else {
          const error = await response.json();
          alert('Erro ao excluir: ' + (error.error || 'Erro desconhecido'));
        }
      } catch (error) {
        console.error('Erro ao excluir profissional:', error);
        alert('Erro ao conectar com o servidor');
      }
      }

      function cancelarEdicao() {
      profissionalEditando = null;
      document.getElementById('form-profissional').reset();
      document.getElementById('btn-text').textContent = 'Cadastrar Profissional';
      }

      document.getElementById('btn-cancelar').addEventListener('click', () => {
      if (profissionalEditando) {
        cancelarEdicao();
      } else {
        window.location.href = 'medicos.html';
      }
      });

      document.getElementById('form-profissional').addEventListener('submit', async (e) => {
      e.preventDefault();

      const formData = {
        nome: document.getElementById('nome').value,
        especialidade: document.getElementById('especialidade').value,
        crm: document.getElementById('crm').value,
        telefone: document.getElementById('telefone').value,
        email: document.getElementById('email').value
      };

      const mensagemDiv = document.getElementById('mensagem');

      try {
        const url = profissionalEditando 
          ? `http://localhost:3000/profissionais/${profissionalEditando}`
          : 'http://localhost:3000/profissionais';
        
        const method = profissionalEditando ? 'PUT' : 'POST';

        const response = await fetch(url, {
          method: method,
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(formData)
        });

        if (response.ok) {
          mensagemDiv.className = 'mensagem sucesso';
          mensagemDiv.textContent = profissionalEditando 
            ? '✓ Profissional atualizado com sucesso!'
            : '✓ Profissional cadastrado com sucesso!';
          mensagemDiv.style.display = 'block';
          
          cancelarEdicao();
          carregarProfissionais();
          
          setTimeout(() => {
            mensagemDiv.style.display = 'none';
          }, 3000);
        } else {
          const error = await response.json();
          mensagemDiv.className = 'mensagem erro';
          mensagemDiv.textContent = '✗ Erro: ' + (error.error || 'Não foi possível salvar o profissional');
          mensagemDiv.style.display = 'block';
        }
      } catch (error) {
        mensagemDiv.className = 'mensagem erro';
        mensagemDiv.textContent = '✗ Erro ao conectar com o servidor';
        mensagemDiv.style.display = 'block';
        console.error('Erro:', error);
      }
      });

      carregarProfissionais();
    });
  </script>
</body>
</html>
